

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Deployment &mdash; Ichnaea 1.5 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Ichnaea 1.5 documentation" href="../index.html"/>
        <link rel="up" title="Installation" href="index.html"/>
        <link rel="next" title="Development" href="devel.html"/>
        <link rel="prev" title="Configuration" href="config.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Ichnaea
          

          
          </a>

          
            
            
              <div class="version">
                1.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Using the Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Services API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../import_export.html">Data Export</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Installation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="config.html">Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#diagram">Diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mysql-amazon-rds">MySQL / Amazon RDS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redis-amazon-elasticache">Redis / Amazon ElastiCache</a></li>
<li class="toctree-l3"><a class="reference internal" href="#amazon-s3">Amazon S3</a></li>
<li class="toctree-l3"><a class="reference internal" href="#datadog-statsd-sentry">Datadog / Statsd / Sentry</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-tiles">Image Tiles</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="devel.html">Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../algo/index.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internal_api/index.html">Internal Code API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changes/index.html">Changelog</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ichnaea</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Installation</a> &raquo;</li>
        
      <li>Deployment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/install/deploy.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deployment">
<span id="deploy"></span><h1>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h1>
<div class="section" id="diagram">
<h2>Diagram<a class="headerlink" href="#diagram" title="Permalink to this headline">¶</a></h2>
<p>A full deployment of the application in an AWS environment can include all
of the parts shown in the diagram, but various of these parts are optional:</p>
<a class="reference internal image-reference" href="../_images/deploy.png"><img alt="Deployment Diagram" src="../_images/deploy.png" style="width: 462.0px; height: 348.0px;" /></a>
<p>Specifically Amazon CloudFront and S3 are only used for backup and serving
image tiles and public data downloads for the public website.
Using Combain, Datadog, OpenCellID and Sentry is also optional.
Finally there doesn’t have to be a <cite>admin</cite> EC2 box, but it can be helpful
for debug access and running database migrations.</p>
</div>
<div class="section" id="mysql-amazon-rds">
<h2>MySQL / Amazon RDS<a class="headerlink" href="#mysql-amazon-rds" title="Permalink to this headline">¶</a></h2>
<p>The application is written and tested against MySQL 5.6.x or Amazon RDS of the
same version. The default configuration works for the most part. There are
just three changes you need to do. For example via the my.cnf:</p>
<div class="highlight-ini"><div class="highlight"><pre><span></span><span class="k">[mysqld]</span>
<span class="na">innodb_file_format</span><span class="o">=</span><span class="s">Barracuda</span>
<span class="na">innodb_strict_mode</span><span class="o">=</span><span class="s">on</span>
<span class="na">sql-mode</span><span class="o">=</span><span class="s">&quot;NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES&quot;</span>
</pre></div>
</div>
<p>The web app frontend role only needs access to a read-only read-replica
of the database. The async worker backend role needs access to a read-write
primary database. You can use load balancers like haproxy to distribute
load from the web app frontends over multiple read-replicas. The diagram
shows a final fallback connection, where the web app frontends fall back
to talking to the primary database if all read-replicas are down.
An example of such a haproxy configuration is included in the source code.</p>
</div>
<div class="section" id="redis-amazon-elasticache">
<h2>Redis / Amazon ElastiCache<a class="headerlink" href="#redis-amazon-elasticache" title="Permalink to this headline">¶</a></h2>
<p>The application uses Redis as a queue for the asynchronous task workers and
also uses it directly as a cache and to track API key rate limitations.</p>
<p>You can install a standard local Redis for development or production use.
The application is also compatible with Amazon ElastiCache (Redis).</p>
</div>
<div class="section" id="amazon-s3">
<h2>Amazon S3<a class="headerlink" href="#amazon-s3" title="Permalink to this headline">¶</a></h2>
<p>The application uses Amazon S3 for various tasks, including backup of
<a class="reference internal" href="../glossary.html#term-observations"><span class="xref std std-term">observations</span></a>, export of the aggregated cell table and hosting of
the data map image tiles.</p>
<p>All of these are triggered by asynchronous jobs and you can disable them
if you are not hosted in an Amazon environment.</p>
<p>If you use Amazon S3 you might want to configure a lifecycle policy to
delete old export files after a couple of days and <a class="reference internal" href="../glossary.html#term-observation"><span class="xref std std-term">observation</span></a>
data after one year.</p>
</div>
<div class="section" id="datadog-statsd-sentry">
<h2>Datadog / Statsd / Sentry<a class="headerlink" href="#datadog-statsd-sentry" title="Permalink to this headline">¶</a></h2>
<p>The application uses Statsd to aggregate stats and Sentry to log
exception messages.</p>
<p>To use Statsd, you need to configure it in the config file, specifying
a host and port, for example localhost port 8125.</p>
<p>To get the app to log exceptions to Sentry, you will need to obtain the
DSN for your Sentry instance. Edit location.ini and in the <cite>sentry</cite> section
put your real DSN into the <cite>dsn</cite> setting.</p>
<p>Installation of Statsd and Sentry are outside the scope of this documentation.</p>
</div>
<div class="section" id="image-tiles">
<h2>Image Tiles<a class="headerlink" href="#image-tiles" title="Permalink to this headline">¶</a></h2>
<p>The code includes functionality to render out image tiles for a data map
of places where observations have been made. This part of the code relies
on two external projects. One is the
<a class="reference external" href="https://github.com/ericfischer/datamaps">datamaps image tile generator</a>
the other is <a class="reference external" href="http://pngquant.org/">pngquant</a>. Make sure to install both
of them and make their binaries available on your system path. The datamaps
package includes the <cite>encode</cite>, <cite>enumerate</cite> and <cite>render</cite> tools and the
pngquant package includes a tool called <cite>pngquant</cite>. You can install these
tools on the server running the celery scheduler (celerybeat) and trigger
the <cite>location_map</cite> script via a cron job.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="devel.html" class="btn btn-neutral float-right" title="Development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="config.html" class="btn btn-neutral" title="Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013-2015, Mozilla.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>